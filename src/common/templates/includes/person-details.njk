<div class="{{ m.form_group_class('savedpeople', errors) }}">

{{ govukInput({
  id: "firstName",
  name: "firstName",
  classes: "govuk-input--width-30",
  label: {
    text: __("field_given_name"),
    classes: "govuk-label--m"
  },
  hint: {
    html: __("field_given_name_hint") ~ m.character_count_hint('firstName', MAX_STRING_LENGTH)
  },
  value: person.firstName or req.body.firstName,
  attributes: {
    maxlength: MAX_STRING_LENGTH,
    autocomplete: "off"
  },
  errorMessage: errors | filterArray('identifier', 'firstName') | first | transform({'message': 'text'})
}) }}

{{ govukInput({
  id: "lastName",
  name: "lastName",
  classes: "govuk-input--width-30",
  label: {
    text: __("field_surname"),
    classes: "govuk-label--m"
  },
  value: person.lastName or req.body.lastName,
  attributes: {
    maxlength: MAX_STRING_LENGTH,
    autocomplete: "off"
  },
  errorMessage: errors | filterArray('identifier', 'lastName') | first | transform({'message': 'text'})
}) }}

{% set nationalityItems = [{
  value: "",
  text: ""
}] %}

{% for country in nationalityList | sort(attribute='label') %}
  {% set option = {
    value: country.code,
    text: country.label,
    selected: (person.nationality or req.body.nationality) == country.code
  } %}
  {% set nationalityItems = nationalityItems.concat(option) %}
{% endfor %}

{{ govukSelect({
  id: "nationality",
  name: "nationality",
  classes: "govuk-select",
  label: {
    text: __("field_nationality"),
    classes: "govuk-label--m"
  },
  hint: {
    text: __("field_nationality_hint")
  },
  items: nationalityItems,
  errorMessage: errors | filterArray('identifier', 'nationality') | first | transform({'message': 'text'})
}) }}

  <!-- Date of birth -->
  <div class="{{ m.form_group_class('dob', errors) }}">
    <fieldset class="govuk-fieldset" aria-describedby="dob-hint" role="group">
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
        <h1 class="govuk-fieldset__heading">{{ __('field_dob') }}</h1>
      </legend>
      {{ m.hint('dob', __('field_dob_hint')) }}
      {{ m.error_message('dob', errors, __) }}
      <div class="govuk-date-input" id="dob">
        <div class="govuk-date-input__item">
          <div class="govuk-form-group">
            <label class="govuk-label govuk-date-input__label" for="dobDay">{{ __('field_date_day') }}</label>
            <input id="dobDay" name="dobDay" class="govuk-input govuk-date-input__input govuk-input--width-2"
            type="text" maxLength=2 onKeyup="value = sanitiseDateOrTime(this.value, 'day');autoTab(dobDay, 'day', dobMonth);"
             value="{{cookie.dateSlice('day', person.dateOfBirth) or req.body['dobDay']}}" >
          </div>
        </div>
        <div class="govuk-date-input__item">
          <div class="govuk-form-group">
            <label class="govuk-label" for="dobMonth">{{ __('field_date_month') }}</label>
            <input id="dobMonth" name="dobMonth" class="govuk-input govuk-date-input__input govuk-input--width-2"
            type="text" maxLength=2 onKeyup="value = sanitiseDateOrTime(this.value, 'month');autoTab(dobMonth, 'month', dobYear);"
            value="{{cookie.dateSlice('month', person.dateOfBirth) or req.body['dobMonth']}}" >
          </div>
        </div>
        <div class="govuk-date-input__item">
          <div class="govuk-form-group">
            <label class="govuk-label" for="dobYear">{{ __('field_date_year') }}</label>
            <input id="dobYear" name="dobYear" class="govuk-input govuk-date-input__input govuk-input--width-4" type="text" maxLength=4
            onKeyup="value = sanitiseDateOrTime(this.value, 'year');" value="{{cookie.dateSlice('year', person.dateOfBirth) or req.body['dobYear']}}">
          </div>
        </div>
      </div>
    </fieldset>
  </div>
  <!-- End date of birth -->

  {% set genderItems = [] %}

  {% for choice in genderchoice %}
    {% set item = {
      value: choice.gender,
      text: choice.gender,
      checked: (person.gender == choice.gender) or (req.body.gender == choice.gender)
    } %}
    {% set genderItems = genderItems.concat(item) %}
  {% endfor %}

  {{ govukRadios({
    idPrefix: "gender",
    name: "gender",
    fieldset: {
      legend: {
        text: __("field_gender"),
        classes: "govuk-fieldset__legend--m"
      }
    },
    classes: m.form_group_class('gender', errors),
    errorMessage: errors | filterArray('identifier', 'gender') | first | transform({'message': 'text'}),
    items: genderItems
  }) }}

{{ govukInput({
  id: "birthplace",
  name: "birthplace",
  classes: "govuk-input--width-30",
  label: {
    text: __("field_birth_place"),
    classes: "govuk-label--m"
  },
  value: person.placeOfBirth or req.body.birthplace,
  attributes: {
    maxlength: MAX_STRING_LENGTH,
    autocomplete: "off"
  },
  hint: {
    html: m.character_count_hint('birthplace', MAX_STRING_LENGTH)
  },
  errorMessage: errors | filterArray('identifier', 'birthplace') | first | transform({'message': 'text'})
}) }}

{% set personTypeHintHtml = __('field_person_type_hint') ~ '<br/> <a class="govuk-link" href="https://www.gov.uk/government/publications/aircrew-crm02" target="_blank">Guidance on Crew and Passengers - GOV.UK (www.gov.uk)</a>' %}

{% set personTypeItems = [] %}

{% for choice in persontype %}
  {% set item = {
    value: choice.persontype,
    text: choice.persontype,
    checked: (person.peopleType.name == choice.persontype) or (req.body.personType == choice.persontype)
  } %}
  {% set personTypeItems = personTypeItems.concat(item) %}
{% endfor %}

{{ govukRadios({
  idPrefix: "personType",
  name: "personType",
  fieldset: {
    legend: {
      text: __("field_person_type"),
      classes: "govuk-fieldset__legend--m"
    }
  },
  classes: m.form_group_class('personType', errors),
  hint: {
    html: personTypeHintHtml
  },
  errorMessage: errors | filterArray('identifier', 'personType') | first | transform({'message': 'text'}),
  items: personTypeItems
}) }}

<h2 class="govuk-heading-l">{{ __('heading_travel_document_details') }}</h2>
<p class="govuk-body">{{ __('caption_travel_document_details') }}</p>

{{ govukInput({
  id: "travelDocumentNumber",
  name: "travelDocumentNumber",
  classes: "govuk-input--width-20",
  label: {
    text: __("field_travel_document_number"),
    classes: "govuk-label--m"
  },
  value: person.documentNumber or req.body.travelDocumentNumber,
  attributes: {
    maxlength: MAX_STRING_LENGTH
  },
  hint: {
    html: m.character_count_hint('travelDocumentNumber', MAX_STRING_LENGTH)
  },
  errorMessage: errors | filterArray('identifier', 'travelDocumentNumber') | first | transform({'message': 'text'})
}) }}

  <div class="{{ m.form_group_class('documentExpiryDate', errors) }}" id="documentExpiryDate">
    <fieldset class="govuk-fieldset" aria-describedby="dob-hint" role="group">
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
        <h2 class="govuk-fieldset__heading">{{ __('field_document_expiry_date') }}</h2>
      </legend>
      <span id="dob-hint" class="govuk-hint">{{ __('field_document_expiry_date_hint') }}{{ futureYear }}.</span>
      {{ m.error_message('documentExpiryDate', errors, __) }}
      <div class="govuk-date-input" id="expiry">
        <div class="govuk-date-input__item">
          <div class="govuk-form-group">
            <label class="govuk-label govuk-date-input__label" for="expiryDay">{{ __('field_date_day') }}</label>
            <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="expiryDay" name="expiryDay"
            type="text" maxLength=2 onKeyup="value = sanitiseDateOrTime(this.value, 'day');autoTab(expiryDay, 'day', expiryMonth);"
            value="{{ cookie.dateSlice('day', person.documentExpiryDate) or req.body['expiryDay'] }}" >
          </div>
        </div>
        <div class="govuk-date-input__item">
          <div class="govuk-form-group">
            <label class="govuk-label govuk-date-input__label" for="expiryMonth">{{ __('field_date_month') }}</label>
            <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="expiryMonth" name="expiryMonth"
            type="text" maxLength=2 onKeyup="value = sanitiseDateOrTime(this.value, 'month');autoTab(expiryMonth, 'month', expiryYear);"
            value="{{ cookie.dateSlice('month', person.documentExpiryDate) or req.body['expiryMonth'] }}" >
          </div>
        </div>
        <div class="govuk-date-input__item">
          <div class="govuk-form-group">
            <label class="govuk-label govuk-date-input__label" for="expiryYear">{{ __('field_date_year') }}</label>
            <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="expiryYear" name="expiryYear" type="text" maxLength=4
            value="{{ cookie.dateSlice('year', person.documentExpiryDate) or req.body['expiryYear'] }}" onKeyup="value = sanitiseDateOrTime(this.value, 'year');">
          </div>
        </div>
      </div>
    </fieldset>
  </div>
{% set issuingStateItems = [{ value: "", text: "" }] %}

{% for country in nationalityList | sort(attribute='label') %}
  {% set issuingStateItems = issuingStateItems.concat({
    value: country.code,
    text: country.label,
    selected: (person.issuingState or req.body.issuingState) == country.code
  }) %}
{% endfor %}

{{ govukSelect({
  id: "issuingState",
  name: "issuingState",
  label: {
    text: __("field_issuing_state"),
    classes: "govuk-label--m"
  },
  hint: {
    text: __("field_issuing_state_hint")
  },
  items: issuingStateItems,
  errorMessage: errors | filterArray('identifier', 'issuingState') | first | transform({'message':'text'})
}) }}

  <div class="{{ m.form_group_class('travelDocumentType', errors) }}">
    <label class="govuk-label govuk-label--m" for="travelDocumentType">{{ __('field_travel_document_type') }}</label>
    {{ m.hint('travelDocumentType', __('field_travel_document_type_hint')) }} <p class="govuk-body-l"> <span style="background-color: #66ff66"> {{__('id_card_withdrawl_text_part')}} <a href=https://www.gov.uk/guidance/visiting-the-uk-as-an-eu-eea-or-swiss-citizen>GOV.UK</a>. </span> </p>
    {{ m.error_message('travelDocumentType', errors, __) }}
    <select class="govuk-select" id="travelDocumentType" name="travelDocumentType" onchange="checkDocumentType()">
    {% for document in documenttype %}
      {% if document.documenttype  == person['documentType'] or document.documenttype == req.body.travelDocumentType %}
        <option selected="true">{{document.documenttype}}</option>
      {% else %}
        <option>{{document.documenttype}}</option>
      {% endif %}
    {% endfor %}
    </select>
  </div>

  <div
    class="{{ m.form_group_class('travelDocumentOther', errors) }}"
    id="travelDocumentOtherDiv"
    {{ "hidden" if person.documentType  !== 'Other' }}
  >
    {{ m.hint('travelDocumentOther', __('field_travel_document_type_other')) }}</label>
    <input id="travelDocumentOther" name="travelDocumentOther" class="govuk-input govuk-input--width-20" type="text"
    maxlength="{{ MAX_STRING_LENGTH - 10 }}" value="{{ person.documentDesc or req.body.documentDesc }}">
    {{ m.character_count_hint('travelDocumentOther', MAX_STRING_LENGTH) }}
  </div>

<script type="text/javascript" src="/utils/validator.js"></script>
<script type="text/javascript">
  accessibleAutocomplete.enhanceSelectElement({
    selectElement: document.querySelector('#nationality')
  });
  accessibleAutocomplete.enhanceSelectElement({
    selectElement: document.querySelector('#issuingState')
  });

  function checkDocumentType(){
    if (document.getElementById('travelDocumentType').value == 'Other'){
      document.getElementById('travelDocumentOtherDiv').style.display = 'block';
    }
    else{
      document.getElementById('travelDocumentOtherDiv').style.display = 'none';
    }

  }
</script>
