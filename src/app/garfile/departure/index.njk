{% extends "base-template.njk" %}

{% import "common/templates/includes/macros.njk" as m %}

{% block pageTitle %}
	Create GAR | Departure | {{__('title')}}
{% endblock %}

{% block header %}
{% include "header-user.njk" %}
{% endblock %}

{% block beforeContent %}

  {% include "phase.njk" %}
  <a href="/garfile/home" class="govuk-back-link">Back</a>

{% endblock %}

{% block content %}


  {% import "common/templates/includes/macros.njk" as m %}

  {% if errors %}
    {% include "common/templates/includes/errors.njk" %}
  {% endif %}
  <div class="govuk-grid-row">
	  <div class="govuk-grid-column-two-thirds">
      <form id="page-form" action="/garfile/departure" autocomplete="off" class="form-group" method="post" role="form">

        <!-- Start departure date -->
        <div class="govuk-form-group" id="departureDate">
          <span class="govuk-caption-xl">{{__('section_count', 1, 8)}}</span>
          <h1 class="govuk-heading-xl">{{__('label_departure_details')}}</h1>
          <p class="govuk-body-l">{{__('departure_details_caption')}}</p>
          <div class="{{ m.form_group_class('departureDate', errors) }}">
            <fieldset class="govuk-fieldset" aria-describedby="departureDate-hint" role="group">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
              <h2 class="govuk-fieldset__heading">
                {{__('field_departure_date')}}
              </h2>
            </legend>
            <span id="departureDate-hint" class="govuk-hint">{{__('field_date_hint')}}</span>
            {{ m.error_message('departureDate', errors) }}
            <div class="govuk-date-input" id="departure">
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="departureDay">{{__('field_day')}}</label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="departureDay"
                  name="departureDay" type="number" pattern="[0-9]*" min="1" max="31"
                  value="{{ cookie.dateSlice('day', cookie.getGarDepartureVoyage().departureDate) }}">
                </div>
              </div>

              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="departureMonth">{{__('field_month')}}</label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="departureMonth"
                  name="departureMonth" type="number" pattern="[0-9]*" min="1" max="12"
                  value="{{ cookie.dateSlice('month', cookie.getGarDepartureVoyage().departureDate) }}">
                  </div>
                </div>

              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                    <label class="govuk-label govuk-date-input__label" for="departureYear">{{__('field_year')}}</label>
                    <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="departureYear"
                    name="departureYear" type="number" pattern="[0-9]*" min="1900" max="2200"
                    value="{{ cookie.dateSlice('year', cookie.getGarDepartureVoyage().departureDate) }}">
                  </div>
                </div>
              </div>
            </fieldset>
          </div>
        </div>
        <!-- End departure date -->

        <!-- Start departure time -->
        <div class="govuk-form-group {{ m.form_group_class('departureTime', errors) }}" id="departureTime">
          <fieldset class="govuk-fieldset" aria-describedby="departureTime-hint" role="group">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
              <h2 class="govuk-fieldset__heading">
                {{__('field_departure_time')}}
              </h2>
            </legend>
            <span id="departureTime-hint" class="govuk-hint">{{__('field_time_hint')}}</span>
            {{ m.error_message('departureTime', errors) }}

            <div class="govuk-date-input" id="departureTime">
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="departureHour">{{__('field_hour')}}</label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="departureHour"
                  name="departureHour" type="number" pattern="[0-9]*" min="00" max="23"
                  value="{{ cookie.timeSlice('hour', cookie.getGarDepartureVoyage().departureTime) }}">
                </div>
              </div>

              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="departureMinute">{{__('field_minute')}}</label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="departureMinute"
                  name="departureMinute" type="number" pattern="[0-9]*" min="00" max="59"
                  value="{{ cookie.timeSlice('minute', cookie.getGarDepartureVoyage().departureTime) }}">
                </div>
              </div>
            </div>
          </fieldset>
        </div>
        <!-- End departure time -->

        <!-- Start departure port -->
        <div class="govuk-form-group {{ m.form_group_class('departurePort', errors) }}">
          <label class="govuk-label govuk-label--m" for="departurePort">{{__('field_departure_port')}}</label>
          <span id="departurePort-hint" class="govuk-hint">
            Provide the IATA or ICAO code for the port. If the port does not have a code, enter 'YYYY'. <br>
            The departure port must be different to the arrival port.
          </span>
          {{ m.error_message('departurePort', errors) }}
          <select class="govuk-select" id="departurePort" name="departurePort" value="{{ cookie.getGarDepartureVoyage().departurePort }}">
            {% for airport in airportList|sort(attribute='label') %}
              <option value="{{ airport.id }}" {{ 'selected=selected' if (cookie.getGarDepartureVoyage().departurePort) == airport.id }}>{{ airport.label }}</option>
            {% endfor %}
            <option value="YYYY" {{ 'selected=selected' if (cookie.getGarDepartureVoyage().departurePort) == 'YYYY' }}>No port code available (Enter co-ordinates below) (YYYY)</option>
          </select>
        </div>
        <!-- End departure port -->


        <div class="govuk-form-group">
          <label class="govuk-heading-m">Departure coordinates</label>
          <span id="departureCoordinates-hint" class="govuk-hint">
           You are only required to enter coordinates if your port does not have an IATA / ICAO code.
           Provide coordinates in decimal format to 4 decimal places.
          </span>
        </div>

         <!-- Start departure coords -->
        <div class="govuk-form-group {{ m.form_group_class('departureLat', errors) }}">
          <label class="govuk-label" for="departureLat">
            {{__('field_latitude')}}
          </label>
          <span id="departureLatitude-hint" class="govuk-hint">
            {{__('field_latitude_hint')}}
          </span>

          {{ m.error_message('departureLat', errors) }}
          <input class="govuk-input govuk-input--width-10" id="departureLat" name="departureLat" autocomplete="off" type="text"
          value="{{ cookie.getGarDepartureVoyage().departureLat }}"/>
        </div>

        <div class="govuk-form-group {{ m.form_group_class('departureLong', errors) }}">
          <label class="govuk-label" for="departureLong">
            {{__('field_longitude')}}
          </label>
          <span id="departureLongitude-hint" class="govuk-hint">
            {{__('field_longitude_hint')}}
          </span>
          {{ m.error_message('departureLong', errors) }}
          <input class="govuk-input govuk-input--width-10" id="departureLong" name="departureLong" autocomplete="off" type="text"
          value="{{ cookie.getGarDepartureVoyage().departureLong }}"/>

        </div>
        <!-- End departure coords -->

        <!-- start buttons -->
        <div class="column-two-thirds">
          <input id="newVoyage" class="govuk-button" type="submit"
            name="buttonClicked"
            value="{{__('form_save_and_continue')}}"
            onclick="sendAnalytics(event, 'Add craft to GAR - submit', 'click')">

						<p class="govuk-body-m">
		          <a href="#"
                class="disableAutoFillSubmit"
                onclick="document.forms[0].submit();return false;"
                name="submit_button">{{__('form_save_and_come_back')}}
              </a>
		        </p>
            <p class="govuk-body-m">
              <a href="/home" >{{__('form_exit_without_saving')}}</a>
            </p>
        </div>
        <!-- end buttons -->
        <input type="hidden" name="_csrf" value="{{ csrfToken }}" />
    </form>
  </div>
</div>

<script type="text/javascript" src="/javascripts/accessible-autocomplete.min.js"></script>
<script type="text/javascript">
  accessibleAutocomplete.enhanceSelectElement({
    selectElement: document.querySelector('#departurePort'),
    minLength: 2,
  });
</script>

{% endblock %}
