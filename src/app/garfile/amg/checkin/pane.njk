{% macro statusRow(person) %}

  {% set status = person.amgCheckinStatus.name %}
  {% set code = person.amgCheckinResponseCode %}

  {% if (status === 'Complete') %}
    {% if (code === '0A') %}
      {% set statuscolour = 'green' %}
    {% elif(code === '1Z') %}
      {% set statuscolour = 'red' %}
      {% set statustitle = 'This passenger may not travel' %}
    {% else %}
      {% set statuscolour = 'green caveat' %}
    {% endif %}
    {% set statustitle = __('amg_status_check_response_code_' + person.amgCheckinResponseCode) %}

  {% elif(status === 'Pending') %}
    {% set statuscolour = 'amber' %}
    {% set statustitle = 'Passenger is still waiting for permission to travel' %}
  {% else %}
    {% set statuscolour = 'black' %}
    {% set statustitle = 'There was a problem requesting permission to travel for this passenger' %}
  {% endif %}

  <tr class="govuk-table__row">
    <td class="govuk-table__cell">
      <div>
        <div class="status-disc {{statuscolour}}" title="{{statustitle}}">
          <div class="govuk-template">{{statustitle}}</div>
        </div>
      </div>
    </td>
    <td class="govuk-table__cell">{{person.firstName}}
      {{person.lastName}}</td>
    <td class="govuk-table__cell">
      {{statustitle}}
    </td>
  </tr>

{% endmacro %}

{# <pre>{{garfile | dump(2)}}</pre> #}
<table class="govuk-table">
  <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th class="govuk-table__header" style="width:20%;">Status</th>
      <th class="govuk-table__header">Person</th>
      <th class="govuk-table__header">Permission to Travel</th>
    </tr>
  </thead>
  {% for person in garpeople.items %}
    {# <pre>{{person | dump(2)}}</pre> #}
    {{statusRow(person)}}
  {% endfor %}
</table>

<form action="/garfile/amg/checkin" method="post" class="form">
  <h2 class="govuk-heading-m">{{__('heading_submit_gar')}}</h2>
  <p class="govuk-body-m">{{__('submit_gar_caption')}}</p>
  <input id='review-submit' type="submit" {% if garfile.status.name != 'StatusCheckComplete' %}disabled{% endif %} class="govuk-button" value="{{__('amg_check_form_submit')}}">
  <input type="hidden" name="_csrf" value="{{ csrfToken }}"/>
</form>

<form id="cancel-form" action="/garfile/view" method="post" role="form">
  <button type="submit" id="review-exit" class="govuk-button govuk-button--secondary" data-module="govuk-button">
    {{__('review_gar_exit')}}
  </button>
  <input type="hidden" name="_csrf" value="{{ csrfToken }}"/>
</form>